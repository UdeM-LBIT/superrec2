\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=north,
        align=center,
        yshift=-10,
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\strut\color{#1}},
                align=center,
                inner xsep=0pt, inner ysep=2pt,
                outer xsep=0pt, outer ysep=0pt]
            below:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (288.2058,64.5) [rounded corners={4pt}] -- (288.2058,35.5) -- (438.7549,35.5) [sharp corners] -- (438.7549,0) -- (491.6449,0) [rounded corners={4pt}] -- (491.6449,35.5) -- (622.3698,35.5) [sharp corners] -- (622.3698,162.8865) -- (569.4798,162.8865) [rounded corners={4pt}] -- (569.4798,60.5) -- (383.3141,60.5) [sharp corners] -- (383.3141,64.5) -- cycle;
\path[species background] (129.1099,136.0165) [rounded corners={4pt}] -- (129.1099,88.5366) -- (288.2058,88.5366) [sharp corners] -- (288.2058,64.5) -- (383.3141,64.5) [rounded corners={4pt}] -- (383.3141,88.5366) -- (459.1999,88.5366) [sharp corners] -- (459.1999,223.4965) -- (341.7599,223.4965) [rounded corners={4pt}] -- (341.7599,132.0165) -- (203.9999,132.0165) [sharp corners] -- (203.9999,136.0165) -- cycle;
\path[species background] (0,223.4965) [rounded corners={4pt}] -- (0,146.0165) -- (129.1099,146.0165) [sharp corners] -- (129.1099,136.0165) -- (203.9999,136.0165) [rounded corners={4pt}] -- (203.9999,146.0165) -- (329.7599,146.0165) [sharp corners] -- (329.7599,193.6265) -- (203.9999,193.6265) [rounded corners={4pt}] -- (203.9999,189.6265) -- (129.1099,189.6265) [sharp corners] -- (129.1099,223.4965) -- cycle;
\path[species background, rounded corners={4pt}] (0,223.4965) -- (0,253.4965) -- node[species label] {X} (129.1099,253.4965) -- (129.1099,223.4965);
\path[species background, rounded corners={4pt}] (203.9999,193.6265) -- (203.9999,253.4965) -- node[species label] {Y} (329.7599,253.4965) -- (329.7599,193.6265);
\path[species background, rounded corners={4pt}] (341.7599,223.4965) -- (341.7599,253.4965) -- node[species label] {Z} (459.1999,253.4965) -- (459.1999,223.4965);
\path[species background] (471.1999,206.1265) [rounded corners={4pt}] -- (471.1999,172.8865) -- (569.4798,172.8865) [sharp corners] -- (569.4798,162.8865) -- (622.3698,162.8865) [rounded corners={4pt}] -- (622.3698,172.8865) -- (697.0398,172.8865) [sharp corners] -- (697.0398,198.4965) -- (622.3698,198.4965) [rounded corners={4pt}] -- (622.3698,194.4965) -- (569.4798,194.4965) [sharp corners] -- (569.4798,206.1265) -- cycle;
\path[species background, rounded corners={4pt}] (471.1999,206.1265) -- (471.1999,253.4965) -- node[species label] {W} (569.4798,253.4965) -- (569.4798,206.1265);
\path[species background, rounded corners={4pt}] (622.3698,198.4965) -- (622.3698,253.4965) -- node[species label] {T} (697.0398,253.4965) -- (697.0398,198.4965);
% gene branches
\path[branch={reccolor0}] (308.4133,64.5) |- (466.4499,43.75) (474.9499,43.75) -| (595.9248,162.8865);
\path[branch={reccolor0}] (459.6999,54.75) -- (491.6449,54.75);
\path[branch={reccolor0}] (459.6999,54.75) -| (354.2858,64.5);
\path[branch={reccolor0}] (465.1999,10.0) -- (465.1999,0);
\path[branch={reccolor0}] (459.6999,54.75) |- (442.7549,22.75) (487.6449,22.75) -| (470.6999,39.5);
\path[branch={reccolor0}] (134.8599,136.0165) |- (350.0358,96.7866) (358.5358,96.7866) -| (435.7549,223.4965);
\path[branch={reccolor0}] (354.2858,74.5) -- (354.2858,64.5);
\path[branch={reccolor0}] (354.2858,92.5366) |- (354.2858,88.5366);
\path[branch={reccolor0}] (145.8599,136.0165) |- (300.7058,112.7766) (345.0358,112.7766) -| (399.2299,223.4965);
\path[branch={reccolor0}] (293.9558,126.2665) -- (383.3141,126.2665);
\path[branch={reccolor0}] (293.9558,126.2665) -| (177.5549,136.0165);
\path[branch={reccolor0}] (308.4133,80.0366) -- (308.4133,64.5);
\path[branch={reccolor0}] (293.9558,126.2665) |- (304.1633,84.2866) (312.6633,84.2866) -| (322.8708,106.0366);
\path[branch={reccolor0}] (177.5549,150.0165) -- (177.5549,136.0165);
\path[branch={reccolor0}] (63.025,223.4965) |- (155.1099,156.8215) (199.9999,156.8215) -| (313.1199,193.6265);
\path[branch={reccolor0}] (145.8599,168.6265) -- (145.8599,136.0165);
\path[branch={reccolor0}] (21.915,223.4965) |- (141.6099,172.8765) (150.1099,172.8765) -| (260.2799,193.6265);
\path[branch={reccolor0}] (134.8599,183.8765) -- (134.8599,136.0165);
\path[branch={reccolor0}] (134.8599,183.8765) -- (203.9999,183.8765);
\path[branch={reccolor0}] (134.8599,183.8765) -| (105.665,223.4965);
\path[branch={reccolor0}] (105.665,233.4965) -- (105.665,223.4965);
\path[branch={reccolor0}] (63.025,233.4965) -- (63.025,223.4965);
\path[branch={reccolor0}] (21.915,233.4965) -- (21.915,223.4965);
\path[branch={reccolor0}] (313.1199,233.4965) -- (313.1199,193.6265);
\path[branch={reccolor0}] (252.9899,233.4965) |- (219.5799,222.8115) (254.7399,222.8115) -| (221.3299,233.4965);
\path[branch={reccolor0}] (260.2799,203.6265) -- (260.2799,193.6265);
\path[branch={reccolor0}] (283.3999,233.4965) |- (256.0299,207.8765) (264.5299,207.8765) -| (237.1599,216.1265);
\path[branch={reccolor0}] (435.7549,233.4965) -- (435.7549,223.4965);
\path[branch={reccolor0}] (399.2299,233.4965) -- (399.2299,223.4965);
\path[branch={reccolor0}] (363.9549,233.4965) -- (363.9549,223.4965);
\path[branch={reccolor0}] (595.9248,176.8865) -- (595.9248,162.8865);
\path[branch={reccolor0}] (493.3949,206.1265) |- (573.4798,183.6915) (618.3698,183.6915) -| (662.4823,198.4965);
\path[branch={reccolor0}] (543.6724,216.1265) -- (543.6724,206.1265);
\path[branch={reccolor0}] (557.1449,233.4965) |- (525.8124,222.8115) (561.5324,222.8115) -| (530.1999,233.4965);
\path[branch={reccolor0}] (493.3949,233.4965) -- (493.3949,206.1265);
\path[branch={reccolor0}] (680.3998,233.4965) |- (658.2323,225.2465) (666.7323,225.2465) -| (644.5648,233.4965);
\path[branch={reccolor0}] (662.4823,208.4965) -- (662.4823,198.4965);
\path[branch={reccolor0}] (662.4823,220.9965) |- (662.4823,216.9965);
% gene transfers
\path[transfer branch={reccolor0}] (379.3141,81.5183) to[out=0, in=180] (543.6724,206.1265);
\path[transfer branch={reccolor0}] (657.2323,212.7465) to[out=180, in=0] (363.9549,223.4965);
% events
\node[speciation={reccolor0}] at (470.6999,43.75) {};
\node[loss={reccolor0}] at (491.6449,54.75) {};
\node[duplication={reccolor0}] at (465.1999,22.75) {a, b, c,\\d, e, f, g};
\node[speciation={reccolor0}] at (354.2858,96.7866) {};
\node[horizontal gene transfer={reccolor0}] at (354.2858,81.5183) {a, b, c, d};
\node[speciation={reccolor0}] at (322.8708,112.7766) {c, d, e, f};
\node[loss={reccolor0}] at (383.3141,126.2665) {};
\node[duplication={reccolor0}] at (308.4133,84.2866) {};
\node[speciation={reccolor0}] at (177.5549,156.8215) {d, e, f, g};
\node[speciation={reccolor0}] at (145.8599,172.8765) {};
\node[loss={reccolor0}] at (203.9999,183.8765) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (105.665,234.9965) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (63.025,234.9965) {};
\node[extant gene={reccolor0}{c, d, e, f}] at (21.915,234.9965) {};
\node[extant gene={reccolor0}{d, e, f}] at (313.1199,234.9965) {};
\node[extant gene={reccolor0}{c, e, f}] at (283.3999,234.9965) {};
\node[extant gene={reccolor0}{c, d, e}] at (252.9899,234.9965) {};
\node[extant gene={reccolor0}{c, d, e}] at (221.3299,234.9965) {};
\node[duplication={reccolor0}] at (237.1599,222.8115) {c, d, e};
\node[duplication={reccolor0}] at (260.2799,207.8765) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (435.7549,234.9965) {};
\node[extant gene={reccolor0}{c, e, f}] at (399.2299,234.9965) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (363.9549,234.9965) {};
\node[speciation={reccolor0}] at (595.9248,183.6915) {d, e, f, g};
\node[extant gene={reccolor0}{a, b}] at (557.1449,234.9965) {};
\node[extant gene={reccolor0}{a, b, c}] at (530.1999,234.9965) {};
\node[duplication={reccolor0}] at (543.6724,222.8115) {a, b, c};
\node[extant gene={reccolor0}{d, e, f, g}] at (493.3949,234.9965) {};
\node[extant gene={reccolor0}{d, e, f}] at (680.3998,234.9965) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (644.5648,234.9965) {};
\node[duplication={reccolor0}] at (662.4823,225.2465) {};
\node[horizontal gene transfer={reccolor0}] at (662.4823,212.7465) {\phantom{-}};
\end{tikzpicture}
