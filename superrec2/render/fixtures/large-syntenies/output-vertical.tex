\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species border/.style={
        line width={1pt},
        shorten <={-1pt / 2 + 0.05pt},
        shorten >={-1pt / 2 + 0.05pt},
    },
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
        rounded corners,
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=north,
        yshift=-10
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\strut\color{#1}},
                align=center,
                inner xsep=0pt, inner ysep=2pt,
                outer xsep=0pt, outer ysep=0pt]
            below:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (329.75993,48.60999000000001) -- (329.75993,23.60999) -- (542.308185,23.60999) [sharp corners] -- (542.308185,0) -- (628.528185,0) [rounded corners] -- (628.528185,23.60999) -- (779.698125,23.60999) [sharp corners] -- (779.698125,142.99651999999998) [rounded corners] -- (726.808145,152.99651999999998) -- (726.808145,48.609989999999996) -- (424.868225,48.609989999999996) [sharp corners] -- (424.868225,58.60999000000001) -- cycle;
\path[species background] (129.10995,116.12656) -- (129.10995,72.64658000000001) -- (329.75993,72.64658000000001) [sharp corners] -- (329.75993,48.60999000000001) -- (424.868225,48.60999000000001) [rounded corners] -- (424.868225,72.64658000000001) -- (542.308185,72.64658000000001) [sharp corners] -- (542.308185,199.60651) [rounded corners] -- (424.868225,209.60651) -- (424.868225,116.12656000000001) -- (203.99993,116.12656000000001) [sharp corners] -- (203.99993,126.12656) -- cycle;
\path[species background] (0,199.60651) -- (0,126.12656) -- (129.10995,126.12656) [sharp corners] -- (129.10995,116.12656) -- (203.99993,116.12656) [rounded corners] -- (203.99993,126.12656) -- (329.75993,126.12656) [sharp corners] -- (329.75993,169.73655) [rounded corners] -- (203.99993,179.73655) -- (203.99993,169.73655) -- (129.10995,169.73655) [sharp corners] -- (129.10995,209.60651) -- cycle;
\path[species background] (0,199.60651) -- (0,229.60651) -- (129.10995,229.60651) -- (129.10995,199.60651);
\path[species background] (203.99993,169.73655) -- (203.99993,229.60651) -- (329.75993,229.60651) -- (329.75993,169.73655);
\path[species background] (424.868225,199.60651) -- (424.868225,229.60651) -- (542.308185,229.60651) -- (542.308185,199.60651);
\path[species background] (628.528185,182.23654999999997) -- (628.528185,152.99651999999998) -- (726.808145,152.99651999999998) [sharp corners] -- (726.808145,142.99651999999998) -- (779.698125,142.99651999999998) [rounded corners] -- (779.698125,152.99651999999998) -- (854.368105,152.99651999999998) [sharp corners] -- (854.368105,174.60650999999996) [rounded corners] -- (779.698125,184.60650999999996) -- (779.698125,174.60651) -- (726.808145,174.60651) [sharp corners] -- (726.808145,192.23654999999997) -- cycle;
\path[species background] (628.528185,182.23654999999997) -- (628.528185,229.60650999999996) -- (726.808145,229.60650999999996) -- (726.808145,182.23654999999997);
\path[species background] (779.698125,174.60650999999996) -- (779.698125,229.60650999999996) -- (854.368105,229.60650999999996) -- (854.368105,174.60650999999996);
% species
\path[species border] (329.75993,48.60999000000001) -- (329.75993,23.60999) -- (542.308185,23.60999) -- (542.308185,0);
\path[species border] (779.698125,142.99651999999998) -- (779.698125,23.60999) -- (628.528185,23.60999) -- (628.528185,0);
\path[species border] (424.868225,48.60999000000001) -- (424.868225,48.609989999999996) -- (726.808145,48.609989999999996) -- (726.808145,142.99651999999998);
\path[species border] (129.10995,116.12656) -- (129.10995,72.64658000000001) -- (329.75993,72.64658000000001) -- (329.75993,48.60999000000001);
\path[species border] (542.308185,199.60651) -- (542.308185,72.64658000000001) -- (424.868225,72.64658000000001) -- (424.868225,48.60999000000001);
\path[species border] (203.99993,116.12656) -- (203.99993,116.12656000000001) -- (424.868225,116.12656000000001) -- (424.868225,199.60651);
\path[species border] (0,199.60651) -- (0,126.12656) -- (129.10995,126.12656) -- (129.10995,116.12656);
\path[species border] (329.75993,169.73655) -- (329.75993,126.12656) -- (203.99993,126.12656) -- (203.99993,116.12656);
\path[species border] (129.10995,199.60651) -- (129.10995,169.73655) -- (203.99993,169.73655) -- (203.99993,169.73655);
\path[species border] (0,199.60651) -- (0,229.60651) -- node[species label] {X} (129.10995,229.60651) -- (129.10995,199.60651);
\path[species border] (203.99993,169.73655) -- (203.99993,229.60651) -- node[species label] {Y} (329.75993,229.60651) -- (329.75993,169.73655);
\path[species border] (424.868225,199.60651) -- (424.868225,229.60651) -- node[species label] {Z} (542.308185,229.60651) -- (542.308185,199.60651);
\path[species border] (628.528185,182.23654999999997) -- (628.528185,152.99651999999998) -- (726.808145,152.99651999999998) -- (726.808145,142.99651999999998);
\path[species border] (854.368105,174.60650999999996) -- (854.368105,152.99651999999998) -- (779.698125,152.99651999999998) -- (779.698125,142.99651999999998);
\path[species border] (726.808145,182.23654999999997) -- (726.808145,174.60651) -- (779.698125,174.60651) -- (779.698125,174.60650999999996);
\path[species border] (628.528185,182.23654999999997) -- (628.528185,229.60650999999996) -- node[species label] {W} (726.808145,229.60650999999996) -- (726.808145,182.23654999999997);
\path[species border] (779.698125,174.60650999999996) -- (779.698125,229.60650999999996) -- node[species label] {T} (854.368105,229.60650999999996) -- (854.368105,174.60650999999996);
% gene branches
\draw[branch={reccolor0}] (349.9674275,48.60999000000001) |- (586.668185,31.85999) (595.168185,31.85999) -| (753.253135,142.99651999999998);
\draw[branch={reccolor0}] (579.918185,42.859989999999996) -- (628.528185,42.859989999999996);
\draw[branch={reccolor0}] (579.918185,42.859989999999996) -| (395.83992,48.60999000000001);
\path[branch={reccolor0}] (585.418185,10.0) -- (585.418185,0);
\draw[branch={reccolor0}] (579.918185,42.859989999999996) |- (546.308185,16.804994999999998) (624.528185,16.804994999999998) -| (590.918185,27.60999);
\draw[branch={reccolor0}] (134.85995,116.12656) |- (391.58992,80.89658000000001) (400.08992,80.89658000000001) -| (518.863195,199.60651);
\path[branch={reccolor0}] (395.83992,58.60999000000001) -- (395.83992,48.60999000000001);
\draw[branch={reccolor0}] (395.83992,76.64658000000001) |- (395.83992,72.64658000000001);
\draw[branch={reccolor0}] (145.85995,116.12656) |- (342.25993,96.88657000000002) (386.58992,96.88657000000002) -| (482.33820499999996,199.60651);
\draw[branch={reccolor0}] (335.50993,110.37656000000001) -- (424.868225,110.37656000000001);
\draw[branch={reccolor0}] (335.50993,110.37656000000001) -| (177.55494000000002,116.12656);
\path[branch={reccolor0}] (349.9674275,64.14658000000001) -- (349.9674275,48.60999000000001);
\draw[branch={reccolor0}] (335.50993,110.37656000000001) |- (345.7174275,68.39658000000001) (354.2174275,68.39658000000001) -| (364.424925,90.14658000000001);
\path[branch={reccolor0}] (177.55494,130.12655999999998) -- (177.55494000000002,116.12656);
\draw[branch={reccolor0}] (63.02498,199.60651) |- (155.10995,136.93155499999997) (199.99993,136.93155499999997) -| (313.11993,169.73655);
\path[branch={reccolor0}] (145.85995,148.73655) -- (145.85995,116.12656);
\draw[branch={reccolor0}] (21.914995000000005,199.60651) |- (141.60995,152.98655) (150.10995,152.98655) -| (260.27993000000004,169.73655);
\path[branch={reccolor0}] (134.85995,163.98655) -- (134.85995,116.12656);
\draw[branch={reccolor0}] (134.85995,163.98655) -- (203.99993,163.98655);
\draw[branch={reccolor0}] (134.85995,163.98655) -| (105.66496,199.60651);
\path[branch={reccolor0}] (105.66496,209.60651) -- (105.66496,199.60651);
\path[branch={reccolor0}] (63.02498,209.60651) -- (63.02498,199.60651);
\path[branch={reccolor0}] (21.914995,209.60651) -- (21.914995000000005,199.60651);
\path[branch={reccolor0}] (313.11992999999995,209.60651) -- (313.11993,169.73655);
\draw[branch={reccolor0}] (252.98993000000002,209.60651) |- (219.57993,198.92153) (254.73993,198.92153) -| (221.32993000000002,209.60651);
\path[branch={reccolor0}] (260.27993000000004,179.73655) -- (260.27993000000004,169.73655);
\draw[branch={reccolor0}] (283.39993,209.60651) |- (256.02993000000004,183.98655) (264.52993000000004,183.98655) -| (237.15992999999997,192.23655);
\path[branch={reccolor0}] (518.863195,209.60651) -- (518.863195,199.60651);
\path[branch={reccolor0}] (482.33820499999996,209.60651) -- (482.33820499999996,199.60651);
\path[branch={reccolor0}] (447.06321499999996,209.60651) -- (447.06321499999996,199.60651);
\path[branch={reccolor0}] (753.2531349999999,156.99651999999998) -- (753.253135,142.99651999999998);
\draw[branch={reccolor0}] (650.723175,182.23654999999997) |- (730.808145,163.80151499999997) (775.698125,163.80151499999997) -| (819.81061,174.60650999999996);
\path[branch={reccolor0}] (701.00066,192.23654999999997) -- (701.0006599999999,182.23654999999997);
\draw[branch={reccolor0}] (714.4731549999999,209.60650999999996) |- (683.14066,198.92152999999996) (718.86066,198.92152999999996) -| (687.528165,209.60650999999996);
\path[branch={reccolor0}] (650.723175,209.60650999999996) -- (650.723175,182.23654999999997);
\draw[branch={reccolor0}] (837.728105,209.60650999999996) |- (815.56061,201.35650999999996) (824.06061,201.35650999999996) -| (801.893115,209.60650999999996);
\path[branch={reccolor0}] (819.81061,184.60650999999996) -- (819.81061,174.60650999999996);
\draw[branch={reccolor0}] (819.81061,197.10650999999996) |- (819.81061,193.10650999999996);
% gene transfers
\draw[transfer branch={reccolor0}] (420.868225,65.628285) to[out=0, in=180] (701.0006599999999,182.23654999999997);
\draw[transfer branch={reccolor0}] (814.560565,188.85650999999996) to[out=180, in=0] (447.06321499999996,199.60651);
% events
\node[speciation={reccolor0}] at (590.918185,31.85999) {};
\node[loss={reccolor0}] at (628.528185,42.859989999999996) {};
\node[duplication={reccolor0}] at (585.418185,16.804994999999998) {a, b, c, d, e, f, g};
\node[speciation={reccolor0}] at (395.83992,80.89658000000001) {};
\node[horizontal gene transfer={reccolor0}] at (395.83992,65.628285) {a, b, c, d};
\node[speciation={reccolor0}] at (364.424925,96.88657000000002) {c, d, e, f};
\node[loss={reccolor0}] at (424.868225,110.37656000000001) {};
\node[duplication={reccolor0}] at (349.9674275,68.39658000000001) {};
\node[speciation={reccolor0}] at (177.55494,136.93155499999997) {d, e, f, g};
\node[speciation={reccolor0}] at (145.85995,152.98655) {};
\node[loss={reccolor0}] at (203.99993,163.98655) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (105.66496,211.10651) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (63.02498,211.10651) {};
\node[extant gene={reccolor0}{c, d, e, f}] at (21.914995,211.10651) {};
\node[extant gene={reccolor0}{d, e, f}] at (313.11992999999995,211.10651) {};
\node[extant gene={reccolor0}{c, e, f}] at (283.39993,211.10651) {};
\node[extant gene={reccolor0}{c, d, e}] at (252.98993000000002,211.10651) {};
\node[extant gene={reccolor0}{c, d, e}] at (221.32993000000002,211.10651) {};
\node[duplication={reccolor0}] at (237.15992999999997,198.92153) {c, d, e};
\node[duplication={reccolor0}] at (260.27993000000004,183.98655) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (518.863195,211.10651) {};
\node[extant gene={reccolor0}{c, e, f}] at (482.33820499999996,211.10651) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (447.06321499999996,211.10651) {};
\node[speciation={reccolor0}] at (753.2531349999999,163.80151499999997) {d, e, f, g};
\node[extant gene={reccolor0}{a, b}] at (714.4731549999999,211.10650999999996) {};
\node[extant gene={reccolor0}{a, b, c}] at (687.528165,211.10650999999996) {};
\node[duplication={reccolor0}] at (701.00066,198.92152999999996) {a, b, c};
\node[extant gene={reccolor0}{d, e, f, g}] at (650.723175,211.10650999999996) {};
\node[extant gene={reccolor0}{d, e, f}] at (837.728105,211.10650999999996) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (801.893115,211.10650999999996) {};
\node[duplication={reccolor0}] at (819.81061,201.35650999999996) {};
\node[horizontal gene transfer={reccolor0}] at (819.81061,188.85650999999996) {\phantom{-}};
\end{tikzpicture}
