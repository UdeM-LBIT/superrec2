\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=west,
        align=left,
        xshift=10,
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\color{#1}},
                align=justify,
                inner xsep=4pt, inner ysep=0pt,
                outer xsep=0pt, outer ysep=0pt]
            right:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (83.89,130.1457) [rounded corners={4pt}] -- (54.89,130.1457) -- (54.89,193.4797) [sharp corners] -- (0,193.4797) -- (0,226.9797) [rounded corners={4pt}] -- (54.89,226.9797) -- (54.89,282.6896) [sharp corners] -- (255.6566,282.6896) -- (255.6566,261.0796) [rounded corners={4pt}] -- (79.89,261.0796) -- (79.89,176.3939) [sharp corners] -- (83.89,176.3939) -- cycle;
\path[species background] (222.2766,44.9599) [rounded corners={4pt}] -- (143.9466,44.9599) -- (143.9466,130.1457) [sharp corners] -- (83.89,130.1457) -- (83.89,176.3939) [rounded corners={4pt}] -- (143.9466,176.3939) -- (143.9466,204.2297) [sharp corners] -- (350.5966,204.2297) -- (350.5966,159.2698) [rounded corners={4pt}] -- (218.2766,159.2698) -- (218.2766,88.5699) [sharp corners] -- (222.2766,88.5699) -- cycle;
\path[species background] (350.5966,0) [rounded corners={4pt}] -- (232.2766,0) -- (232.2766,44.9599) [sharp corners] -- (222.2766,44.9599) -- (222.2766,88.5699) [rounded corners={4pt}] -- (232.2766,88.5699) -- (232.2766,147.2698) [sharp corners] -- (311.1666,147.2698) -- (311.1666,88.5699) [rounded corners={4pt}] -- (307.1666,88.5699) -- (307.1666,44.9599) [sharp corners] -- (350.5966,44.9599) -- cycle;
\path[species background, rounded corners={4pt}] (350.5966,0) -- (411.4866,0) -- node[species label] {X} (411.4866,44.9599) -- (350.5966,44.9599);
\path[species background, rounded corners={4pt}] (311.1666,88.5699) -- (411.4866,88.5699) -- node[species label] {Y} (411.4866,147.2698) -- (311.1666,147.2698);
\path[species background, rounded corners={4pt}] (350.5966,159.2698) -- (411.4866,159.2698) -- node[species label] {Z} (411.4866,204.2297) -- (350.5966,204.2297);
\path[species background] (322.5466,216.2297) [rounded corners={4pt}] -- (265.6566,216.2297) -- (265.6566,261.0796) [sharp corners] -- (255.6566,261.0796) -- (255.6566,282.6896) [rounded corners={4pt}] -- (265.6566,282.6896) -- (265.6566,313.7796) [sharp corners] -- (326.0965,313.7796) -- (326.0965,282.6896) [rounded corners={4pt}] -- (318.5466,282.6896) -- (318.5466,261.0796) [sharp corners] -- (322.5466,261.0796) -- cycle;
\path[species background, rounded corners={4pt}] (322.5466,216.2297) -- (411.4866,216.2297) -- node[species label] {W} (411.4866,261.0796) -- (322.5466,261.0796);
\path[species background, rounded corners={4pt}] (326.0965,282.6896) -- (411.4866,282.6896) -- node[species label] {T} (411.4866,313.7796) -- (326.0965,313.7796);
% gene branches
\path[branch={reccolor0}] (83.89,142.6407) -| (63.14,211.4797) (63.14,219.9797) |- (255.6566,271.8846);
\path[branch={reccolor0}] (74.14,204.7297) -- (74.14,226.9797);
\path[branch={reccolor0}] (74.14,204.7297) |- (83.89,165.3756);
\path[branch={reccolor0}] (10.0,210.2297) -- (0,210.2297);
\path[branch={reccolor0}] (74.14,204.7297) -| (32.445,197.4797) (32.445,222.9797) |- (58.89,215.7297);
\path[branch={reccolor0}] (222.2766,50.7099) -| (152.1966,161.1256) (152.1966,169.6256) |- (350.5966,195.7948);
\path[branch={reccolor0}] (93.89,165.3756) -- (83.89,165.3756);
\path[branch={reccolor0}] (147.9466,165.3756) |- (143.9466,165.3756);
\path[branch={reccolor0}] (222.2766,61.7099) -| (183.6116,142.6457) (183.6116,156.1256) |- (350.5966,181.8698);
\path[branch={reccolor0}] (212.5266,135.8957) -- (212.5266,176.3939);
\path[branch={reccolor0}] (212.5266,135.8957) |- (222.2766,77.7649);
\path[branch={reccolor0}] (135.4466,142.6407) -- (83.89,142.6407);
\path[branch={reccolor0}] (212.5266,135.8957) -| (139.6966,138.3907) (139.6966,146.8907) |- (161.4466,149.3857);
\path[branch={reccolor0}] (236.2766,77.7649) -- (222.2766,77.7649);
\path[branch={reccolor0}] (350.5966,22.535) -| (258.7216,70.9599) (258.7216,84.5699) |- (311.1666,138.7798);
\path[branch={reccolor0}] (286.1666,61.7099) -- (222.2766,61.7099);
\path[branch={reccolor0}] (350.5966,8.49) -| (290.4166,57.4599) (290.4166,65.9599) |- (311.1666,114.3699);
\path[branch={reccolor0}] (301.4166,50.7099) -- (222.2766,50.7099);
\path[branch={reccolor0}] (301.4166,50.7099) -- (301.4166,88.5699);
\path[branch={reccolor0}] (301.4166,50.7099) |- (350.5966,36.525);
\path[branch={reccolor0}] (360.5966,36.525) -- (350.5966,36.525);
\path[branch={reccolor0}] (363.0966,22.535) -- (350.5966,22.535);
\path[branch={reccolor0}] (363.6566,8.49) -- (350.5966,8.49);
\path[branch={reccolor0}] (374.2066,138.7798) -- (311.1666,138.7798);
\path[branch={reccolor0}] (372.8266,110.8749) -| (351.2466,97.2549) (351.2466,110.6249) |- (372.8266,97.0049);
\path[branch={reccolor0}] (321.1666,114.3699) -- (311.1666,114.3699);
\path[branch={reccolor0}] (375.3266,124.7998) -| (325.4166,110.1199) (325.4166,118.6199) |- (333.6666,103.9399);
\path[branch={reccolor0}] (360.5966,195.7948) -- (350.5966,195.7948);
\path[branch={reccolor0}] (375.3266,181.8698) -- (350.5966,181.8698);
\path[branch={reccolor0}] (363.0966,167.8248) -- (350.5966,167.8248);
\path[branch={reccolor0}] (269.6566,271.8846) -- (255.6566,271.8846);
\path[branch={reccolor0}] (322.5466,224.7847) -| (292.1016,265.0796) (292.1016,278.6896) |- (326.0965,298.2671);
\path[branch={reccolor0}] (332.5466,245.7097) -- (322.5466,245.7097);
\path[branch={reccolor0}] (382.8166,252.6447) -| (350.4066,239.0247) (350.4066,252.3947) |- (372.2666,238.7747);
\path[branch={reccolor0}] (363.0966,224.7847) -- (322.5466,224.7847);
\path[branch={reccolor0}] (374.2066,305.2896) -| (354.8466,294.0171) (354.8466,302.5171) |- (363.0966,291.2446);
\path[branch={reccolor0}] (336.0965,298.2671) -- (326.0965,298.2671);
\path[branch={reccolor0}] (350.5966,298.2671) |- (346.5966,298.2671);
% gene transfers
\path[transfer branch={reccolor0}] (118.9183,172.3939) to[out=-90, in=90] (322.5466,245.7097);
\path[transfer branch={reccolor0}] (341.3465,294.0171) to[out=90, in=-90] (350.5966,167.8248);
% events
\node[speciation={reccolor0}] at (63.14,215.7297) {};
\node[loss={reccolor0}] at (74.14,226.9797) {};
\node[duplication={reccolor0}] at (32.445,210.2297) {a, b, c,\\d, e, f, g};
\node[speciation={reccolor0}] at (152.1966,165.3756) {};
\node[horizontal gene transfer={reccolor0}] at (118.9183,165.3756) {a, b, c, d};
\node[speciation={reccolor0}] at (183.6116,149.3857) {c, d, e, f};
\node[loss={reccolor0}] at (212.5266,176.3939) {};
\node[duplication={reccolor0}] at (139.6966,142.6407) {};
\node[speciation={reccolor0}] at (258.7216,77.7649) {d, e, f, g};
\node[speciation={reccolor0}] at (290.4166,61.7099) {};
\node[loss={reccolor0}] at (301.4166,88.5699) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (362.0966,36.525) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.5966,22.535) {};
\node[extant gene={reccolor0}{c, d, e, f}] at (365.1566,8.49) {};
\node[extant gene={reccolor0}{d, e, f}] at (375.7066,138.7798) {};
\node[extant gene={reccolor0}{c, e, f}] at (376.8266,124.7998) {};
\node[extant gene={reccolor0}{c, d, e}] at (374.3266,110.8749) {};
\node[extant gene={reccolor0}{c, d, e}] at (374.3266,97.0049) {};
\node[duplication={reccolor0}] at (351.2466,103.9399) {c, d, e};
\node[duplication={reccolor0}] at (325.4166,114.3699) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (362.0966,195.7948) {};
\node[extant gene={reccolor0}{c, e, f}] at (376.8266,181.8698) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.5966,167.8248) {};
\node[speciation={reccolor0}] at (292.1016,271.8846) {d, e, f, g};
\node[extant gene={reccolor0}{a, b}] at (384.3166,252.6447) {};
\node[extant gene={reccolor0}{a, b, c}] at (373.7666,238.7747) {};
\node[duplication={reccolor0}] at (350.4066,245.7097) {a, b, c};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.5966,224.7847) {};
\node[extant gene={reccolor0}{d, e, f}] at (375.7066,305.2896) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.5966,291.2446) {};
\node[duplication={reccolor0}] at (354.8466,298.2671) {};
\node[horizontal gene transfer={reccolor0}] at (341.3465,298.2671) {\phantom{-}};
\end{tikzpicture}
