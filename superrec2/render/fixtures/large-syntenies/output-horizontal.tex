\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=west,
        align=left,
        xshift=10,
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\color{#1}},
                align=justify,
                inner xsep=4pt, inner ysep=0pt,
                outer xsep=0pt, outer ysep=0pt]
            right:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (83.88997999999998,130.14566250000001) [rounded corners={4pt}] -- (54.88998,130.14566250000001) -- (54.88998,193.479745) [sharp corners] -- (0,193.479745) -- (0,226.979715) [rounded corners={4pt}] -- (54.88998,226.979715) -- (54.88998,282.68963) [sharp corners] -- (255.65658,282.68963) -- (255.65658,261.07964000000004) [rounded corners={4pt}] -- (79.88998000000001,261.07964000000004) -- (79.88998000000001,176.39393750000002) [sharp corners] -- (83.88997999999998,176.39393750000002) -- cycle;
\path[species background] (222.27658,44.95993) [rounded corners={4pt}] -- (143.94659,44.95993) -- (143.94659,130.14566250000001) [sharp corners] -- (83.88997999999998,130.14566250000001) -- (83.88997999999998,176.39393750000002) [rounded corners={4pt}] -- (143.94659,176.39393750000002) -- (143.94659,204.22973000000002) [sharp corners] -- (350.59658,204.22973000000002) -- (350.59658,159.2698) [rounded corners={4pt}] -- (218.27658,159.2698) -- (218.27658,88.56992) [sharp corners] -- (222.27658,88.56992) -- cycle;
\path[species background] (350.59658,0) [rounded corners={4pt}] -- (232.27658,0) -- (232.27658,44.95993) [sharp corners] -- (222.27658,44.95993) -- (222.27658,88.56992) [rounded corners={4pt}] -- (232.27658,88.56992) -- (232.27658,147.2698) [sharp corners] -- (311.16656,147.2698) -- (311.16656,88.56992) [rounded corners={4pt}] -- (307.16656,88.56992) -- (307.16656,44.95993) [sharp corners] -- (350.59658,44.95993) -- cycle;
\path[
                species background,
                rounded corners={4pt},
            ] (350.59658,0) -- (411.48656,0) -- node[species label] {X} (411.48656,44.95993) -- (350.59658,44.95993);
\path[
                species background,
                rounded corners={4pt},
            ] (311.16656,88.56992) -- (411.48656,88.56992) -- node[species label] {Y} (411.48656,147.2698) -- (311.16656,147.2698);
\path[
                species background,
                rounded corners={4pt},
            ] (350.59658,159.2698) -- (411.48656,159.2698) -- node[species label] {Z} (411.48656,204.22973000000002) -- (350.59658,204.22973000000002);
\path[species background] (322.54656,216.22973000000002) [rounded corners={4pt}] -- (265.65657999999996,216.22973000000002) -- (265.65657999999996,261.07964000000004) [sharp corners] -- (255.65658,261.07964000000004) -- (255.65658,282.68963) [rounded corners={4pt}] -- (265.65657999999996,282.68963) -- (265.65657999999996,313.7796) [sharp corners] -- (326.09649,313.7796) -- (326.09649,282.68963) [rounded corners={4pt}] -- (318.54655999999994,282.68963) -- (318.54655999999994,261.07964000000004) [sharp corners] -- (322.54656,261.07964000000004) -- cycle;
\path[
                species background,
                rounded corners={4pt},
            ] (322.54656,216.22973000000002) -- (411.48656,216.22973000000002) -- node[species label] {W} (411.48656,261.07964000000004) -- (322.54656,261.07964000000004);
\path[
                species background,
                rounded corners={4pt},
            ] (326.09649,282.68963) -- (411.48656000000005,282.68963) -- node[species label] {T} (411.48656000000005,313.7796) -- (326.09649,313.7796);
% species
% gene branches
\draw[branch={reccolor0}] (83.88997999999998,142.64065750000003) -| (63.13998,211.47973) (63.13998,219.97973) |- (255.65658,271.884635);
\draw[branch={reccolor0}] (74.13998000000001,204.72973) -- (74.13998000000001,226.979715);
\draw[branch={reccolor0}] (74.13998000000001,204.72973) |- (83.88997999999998,165.37564250000003);
\path[branch={reccolor0}] (10.0,210.22973000000002) -- (0,210.22973);
\draw[branch={reccolor0}] (74.13998000000001,204.72973) -| (32.444990000000004,197.479745) (32.444990000000004,222.979715) |- (58.88998,215.72973);
\draw[branch={reccolor0}] (222.27658,50.70993) -| (152.19659,161.12564250000003) (152.19659,169.62564250000003) |- (350.59658,195.79475000000002);
\path[branch={reccolor0}] (93.88997999999998,165.37564250000003) -- (83.88997999999998,165.37564250000003);
\draw[branch={reccolor0}] (147.94659,165.37564250000003) |- (143.94659,165.37564250000003);
\draw[branch={reccolor0}] (222.27658,61.70993) -| (183.611585,142.64566250000001) (183.611585,156.12564250000003) |- (350.59658,181.86978000000002);
\draw[branch={reccolor0}] (212.52658,135.89566250000001) -- (212.52658,176.39393750000002);
\draw[branch={reccolor0}] (212.52658,135.89566250000001) |- (222.27658,77.76492499999999);
\path[branch={reccolor0}] (135.44659,142.64065750000003) -- (83.88997999999998,142.64065750000003);
\draw[branch={reccolor0}] (212.52658,135.89566250000001) -| (139.69659,138.39065750000003) (139.69659,146.89065750000003) |- (161.44659,149.38565250000002);
\path[branch={reccolor0}] (236.27658,77.764925) -- (222.27658,77.76492499999999);
\draw[branch={reccolor0}] (350.59658,22.534974999999996) -| (258.72157,70.95993) (258.72157,84.56992) |- (311.16656,138.77981);
\path[branch={reccolor0}] (286.16656,61.70993) -- (222.27658,61.70993);
\draw[branch={reccolor0}] (350.59658,8.489989999999999) -| (290.41656,57.45993) (290.41656,65.95993) |- (311.16656,114.369855);
\path[branch={reccolor0}] (301.41656,50.70993) -- (222.27658,50.70993);
\draw[branch={reccolor0}] (301.41656,50.70993) -- (301.41656,88.56992);
\draw[branch={reccolor0}] (301.41656,50.70993) |- (350.59658,36.524950000000004);
\path[branch={reccolor0}] (360.59658,36.524950000000004) -- (350.59658,36.524950000000004);
\path[branch={reccolor0}] (363.09658,22.534974999999996) -- (350.59658,22.534974999999996);
\path[branch={reccolor0}] (363.65657,8.489989999999999) -- (350.59658,8.489989999999999);
\path[branch={reccolor0}] (374.20655999999997,138.77981) -- (311.16656,138.77981);
\draw[branch={reccolor0}] (372.82656,110.87486) -| (351.24656,97.25489999999999) (351.24656,110.62486) |- (372.82656,97.00489999999999);
\path[branch={reccolor0}] (321.16656,114.369855) -- (311.16656,114.369855);
\draw[branch={reccolor0}] (375.32656,124.79983000000001) -| (325.41656,110.119855) (325.41656,118.619855) |- (333.66656,103.93987999999999);
\path[branch={reccolor0}] (360.59658,195.79475000000002) -- (350.59658,195.79475000000002);
\path[branch={reccolor0}] (375.32656,181.86978000000002) -- (350.59658,181.86978000000002);
\path[branch={reccolor0}] (363.09658,167.82479500000002) -- (350.59658,167.82479500000002);
\path[branch={reccolor0}] (269.65657999999996,271.88463500000006) -- (255.65658,271.884635);
\draw[branch={reccolor0}] (322.54656,224.78472500000004) -| (292.10157,265.07964000000004) (292.10157,278.68963) |- (326.09649,298.26711750000004);
\path[branch={reccolor0}] (332.54656,245.70968000000005) -- (322.54656,245.70968000000005);
\draw[branch={reccolor0}] (382.81658,252.64466000000004) -| (350.40656,239.02470000000005) (350.40656,252.39466000000004) |- (372.26656,238.77470000000002);
\path[branch={reccolor0}] (363.09658,224.78472500000004) -- (322.54656,224.78472500000004);
\draw[branch={reccolor0}] (374.2065600000001,305.28961) -| (354.8465800000001,294.01711750000004) (354.8465800000001,302.51711750000004) |- (363.0965800000001,291.24462500000004);
\path[branch={reccolor0}] (336.09649,298.26711750000004) -- (326.09649,298.26711750000004);
\draw[branch={reccolor0}] (350.5965800000001,298.26711750000004) |- (346.59658,298.26711750000004);
% gene transfers
\draw[transfer branch={reccolor0}] (118.91828499999998,172.39393750000002) to[out=-90, in=90] (322.54656,245.70968000000005);
\draw[transfer branch={reccolor0}] (341.346535,294.01711750000004) to[out=90, in=-90] (350.59658,167.82479500000002);
% events
\node[speciation={reccolor0}] at (63.13998,215.72973) {};
\node[loss={reccolor0}] at (74.13998000000001,226.979715) {};
\node[duplication={reccolor0}] at (32.444990000000004,210.22973000000002) {a, b, c,\\d, e, f, g};
\node[speciation={reccolor0}] at (152.19659,165.37564250000003) {};
\node[horizontal gene transfer={reccolor0}] at (118.91828499999998,165.37564250000003) {a, b, c, d};
\node[speciation={reccolor0}] at (183.611585,149.38565250000002) {c, d, e, f};
\node[loss={reccolor0}] at (212.52658,176.39393750000002) {};
\node[duplication={reccolor0}] at (139.69659,142.64065750000003) {};
\node[speciation={reccolor0}] at (258.72157,77.764925) {d, e, f, g};
\node[speciation={reccolor0}] at (290.41656,61.70993) {};
\node[loss={reccolor0}] at (301.41656,88.56992) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (362.09658,36.524950000000004) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.59658,22.534974999999996) {};
\node[extant gene={reccolor0}{c, d, e, f}] at (365.15657,8.489989999999999) {};
\node[extant gene={reccolor0}{d, e, f}] at (375.70655999999997,138.77981) {};
\node[extant gene={reccolor0}{c, e, f}] at (376.82656,124.79983000000001) {};
\node[extant gene={reccolor0}{c, d, e}] at (374.32656,110.87486) {};
\node[extant gene={reccolor0}{c, d, e}] at (374.32656,97.00489999999999) {};
\node[duplication={reccolor0}] at (351.24656,103.93987999999999) {c, d, e};
\node[duplication={reccolor0}] at (325.41656,114.369855) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (362.09658,195.79475000000002) {};
\node[extant gene={reccolor0}{c, e, f}] at (376.82656,181.86978000000002) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.59658,167.82479500000002) {};
\node[speciation={reccolor0}] at (292.10157,271.88463500000006) {d, e, f, g};
\node[extant gene={reccolor0}{a, b}] at (384.31658,252.64466000000004) {};
\node[extant gene={reccolor0}{a, b, c}] at (373.76656,238.77470000000002) {};
\node[duplication={reccolor0}] at (350.40656,245.70968000000005) {a, b, c};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.59658,224.78472500000004) {};
\node[extant gene={reccolor0}{d, e, f}] at (375.7065600000001,305.28961) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (364.5965800000001,291.24462500000004) {};
\node[duplication={reccolor0}] at (354.8465800000001,298.26711750000004) {};
\node[horizontal gene transfer={reccolor0}] at (341.346535,298.26711750000004) {\phantom{-}};
\end{tikzpicture}
