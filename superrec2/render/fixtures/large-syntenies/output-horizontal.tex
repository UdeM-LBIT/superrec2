\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species border/.style={
        line width={1pt},
        shorten <={-1pt / 2 + 0.05pt},
        shorten >={-1pt / 2 + 0.05pt},
    },
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
        rounded corners,
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=west,
        xshift=10
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\color{#1}},
                align=center,
                inner xsep=4pt, inner ysep=0pt,
                outer xsep=0pt, outer ysep=0pt]
            right:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (113.22000000000003,147.2698) -- (88.22,147.2698) -- (88.22,238.478005) [sharp corners] -- (0,238.478005) -- (0,263.478005) [rounded corners] -- (88.22,263.478005) -- (88.22,331.63291) [sharp corners] -- (280.98660000000007,331.63291) [rounded corners] -- (290.98660000000007,310.02292) -- (113.22,310.02292) -- (113.22,193.518075) [sharp corners] -- (123.22000000000003,193.518075) -- cycle;
\path[species background] (247.60660000000004,44.95993) -- (173.27661000000003,44.95993) -- (173.27661000000003,147.2698) [sharp corners] -- (113.22000000000003,147.2698) -- (113.22000000000003,193.518075) [rounded corners] -- (173.27661000000003,193.518075) -- (173.27661000000003,238.478005) [sharp corners] -- (371.92660000000006,238.478005) [rounded corners] -- (381.92660000000006,193.518075) -- (247.60660000000004,193.518075) -- (247.60660000000004,88.56992) [sharp corners] -- (257.60660000000007,88.56992) -- cycle;
\path[species background] (371.9266,0) -- (257.60660000000007,0) -- (257.60660000000007,44.95993) [sharp corners] -- (247.60660000000004,44.95993) -- (247.60660000000004,88.56992) [rounded corners] -- (257.60660000000007,88.56992) -- (257.60660000000007,147.2698) [sharp corners] -- (332.49658000000005,147.2698) [rounded corners] -- (342.49658000000005,88.56992) -- (332.4965800000001,88.56992) -- (332.4965800000001,44.95993) [sharp corners] -- (381.9266,44.95993) -- cycle;
\path[species background] (371.9266,0) -- (432.81658,0) -- (432.81658,44.95993) -- (371.9266,44.95993);
\path[species background] (332.49658000000005,88.56992) -- (432.81658000000004,88.56992) -- (432.81658000000004,147.2698) -- (332.49658000000005,147.2698);
\path[species background] (371.92660000000006,193.518075) -- (432.81658000000004,193.518075) -- (432.81658000000004,238.478005) -- (371.92660000000006,238.478005);
\path[species background] (343.8765800000001,263.478005) -- (290.98660000000007,263.478005) -- (290.98660000000007,310.02292) [sharp corners] -- (280.98660000000007,310.02292) -- (280.98660000000007,331.63291) [rounded corners] -- (290.98660000000007,331.63291) -- (290.98660000000007,364.41788499999996) [sharp corners] -- (347.42651000000006,364.41788499999996) [rounded corners] -- (357.42651000000006,333.32791499999996) -- (343.87658000000005,333.32791499999996) -- (343.87658000000005,308.327915) [sharp corners] -- (353.8765800000001,308.327915) -- cycle;
\path[species background] (343.8765800000001,263.478005) -- (432.8165800000001,263.478005) -- (432.8165800000001,308.327915) -- (343.8765800000001,308.327915);
\path[species background] (347.42651000000006,333.32791499999996) -- (432.81658000000004,333.32791499999996) -- (432.81658000000004,364.41788499999996) -- (347.42651000000006,364.41788499999996);
% species
\path[species border] (113.22000000000003,147.2698) -- (88.22,147.2698) -- (88.22,238.478005) -- (0,238.478005);
\path[species border] (280.98660000000007,331.63291) -- (88.22,331.63291) -- (88.22,263.478005) -- (0,263.478005);
\path[species border] (113.22000000000003,193.518075) -- (113.22,193.518075) -- (113.22,310.02292) -- (280.98660000000007,310.02292);
\path[species border] (247.60660000000004,44.95993) -- (173.27661000000003,44.95993) -- (173.27661000000003,147.2698) -- (113.22000000000003,147.2698);
\path[species border] (371.92660000000006,238.478005) -- (173.27661000000003,238.478005) -- (173.27661000000003,193.518075) -- (113.22000000000003,193.518075);
\path[species border] (247.60660000000004,88.56992) -- (247.60660000000004,88.56992) -- (247.60660000000004,193.518075) -- (371.92660000000006,193.518075);
\path[species border] (371.9266,0) -- (257.60660000000007,0) -- (257.60660000000007,44.95993) -- (247.60660000000004,44.95993);
\path[species border] (332.49658000000005,147.2698) -- (257.60660000000007,147.2698) -- (257.60660000000007,88.56992) -- (247.60660000000004,88.56992);
\path[species border] (371.9266,44.95993) -- (332.4965800000001,44.95993) -- (332.4965800000001,88.56992) -- (332.49658000000005,88.56992);
\path[species border] (371.9266,0) -- (432.81658,0) -- node[species label] {X} (432.81658,44.95993) -- (371.9266,44.95993);
\path[species border] (332.49658000000005,88.56992) -- (432.81658000000004,88.56992) -- node[species label] {Y} (432.81658000000004,147.2698) -- (332.49658000000005,147.2698);
\path[species border] (371.92660000000006,193.518075) -- (432.81658000000004,193.518075) -- node[species label] {Z} (432.81658000000004,238.478005) -- (371.92660000000006,238.478005);
\path[species border] (343.8765800000001,263.478005) -- (290.98660000000007,263.478005) -- (290.98660000000007,310.02292) -- (280.98660000000007,310.02292);
\path[species border] (347.42651000000006,364.41788499999996) -- (290.98660000000007,364.41788499999996) -- (290.98660000000007,331.63291) -- (280.98660000000007,331.63291);
\path[species border] (343.8765800000001,308.327915) -- (343.87658000000005,308.327915) -- (343.87658000000005,333.32791499999996) -- (347.42651000000006,333.32791499999996);
\path[species border] (343.8765800000001,263.478005) -- (432.8165800000001,263.478005) -- node[species label] {W} (432.8165800000001,308.327915) -- (343.8765800000001,308.327915);
\path[species border] (347.42651000000006,333.32791499999996) -- (432.81658000000004,333.32791499999996) -- node[species label] {T} (432.81658000000004,364.41788499999996) -- (347.42651000000006,364.41788499999996);
% gene branches
\draw[branch={reccolor0}] (113.22000000000003,159.76479500000002) -| (96.47,250.978005) (96.47,259.478005) |- (280.98660000000007,320.82791499999996);
\draw[branch={reccolor0}] (107.47,244.228005) -- (107.47,263.478005);
\draw[branch={reccolor0}] (107.47,244.228005) |- (113.22000000000003,182.49978000000002);
\path[branch={reccolor0}] (10.0,249.728005) -- (0,249.728005);
\draw[branch={reccolor0}] (107.47,244.228005) -| (49.11,242.92301) (49.11,256.533) |- (92.22,255.228005);
\draw[branch={reccolor0}] (247.60660000000004,50.70993) -| (181.52661000000003,178.24978000000002) (181.52661000000003,186.74978000000002) |- (371.92660000000006,230.043025);
\path[branch={reccolor0}] (123.22000000000003,182.49978000000002) -- (113.22000000000003,182.49978000000002);
\draw[branch={reccolor0}] (177.27661000000003,182.49978000000002) |- (173.27661000000003,182.49978000000002);
\draw[branch={reccolor0}] (247.60660000000004,61.70993) -| (212.94160500000004,159.7698) (212.94160500000004,173.24978000000002) |- (371.92660000000006,216.118055);
\draw[branch={reccolor0}] (241.85660000000004,153.0198) -- (241.85660000000004,193.518075);
\draw[branch={reccolor0}] (241.85660000000004,153.0198) |- (247.60660000000004,77.76492499999999);
\path[branch={reccolor0}] (164.77661000000003,159.76479500000002) -- (113.22000000000003,159.76479500000002);
\draw[branch={reccolor0}] (241.85660000000004,153.0198) -| (169.02661000000003,155.51479500000002) (169.02661000000003,164.01479500000002) |- (190.77661000000003,166.50979);
\path[branch={reccolor0}] (261.60660000000007,77.764925) -- (247.60660000000004,77.76492499999999);
\draw[branch={reccolor0}] (371.9266,22.534974999999996) -| (284.0515900000001,70.95993) (284.0515900000001,84.56992) |- (332.49658000000005,138.77981);
\path[branch={reccolor0}] (311.49658000000005,61.70993) -- (247.60660000000004,61.70993);
\draw[branch={reccolor0}] (371.9266,8.489989999999999) -| (315.74658000000005,57.45993) (315.74658000000005,65.95993) |- (332.49658000000005,114.369855);
\path[branch={reccolor0}] (326.7465800000001,50.70993) -- (247.60660000000004,50.70993);
\draw[branch={reccolor0}] (326.7465800000001,50.70993) -- (326.7465800000001,88.56992);
\draw[branch={reccolor0}] (326.7465800000001,50.70993) |- (371.9266,36.524950000000004);
\path[branch={reccolor0}] (381.9266,36.524950000000004) -- (371.9266,36.524950000000004);
\path[branch={reccolor0}] (384.4266,22.534974999999996) -- (371.9266,22.534974999999996);
\path[branch={reccolor0}] (384.98659,8.489989999999999) -- (371.9266,8.489989999999999);
\path[branch={reccolor0}] (395.5365800000001,138.77981) -- (332.49658000000005,138.77981);
\draw[branch={reccolor0}] (394.1565800000001,110.87486) -| (372.57658000000004,97.25489999999999) (372.57658000000004,110.62486) |- (394.1565800000001,97.00489999999999);
\path[branch={reccolor0}] (342.49658000000005,114.369855) -- (332.49658000000005,114.369855);
\draw[branch={reccolor0}] (396.6565800000001,124.79983000000001) -| (346.74658000000005,110.119855) (346.74658000000005,118.619855) |- (354.99658000000005,103.93987999999999);
\path[branch={reccolor0}] (381.92660000000006,230.043025) -- (371.92660000000006,230.043025);
\path[branch={reccolor0}] (396.6565800000001,216.118055) -- (371.92660000000006,216.118055);
\path[branch={reccolor0}] (384.42660000000006,202.07307) -- (371.92660000000006,202.07307);
\path[branch={reccolor0}] (294.98660000000007,320.827915) -- (280.98660000000007,320.82791499999996);
\draw[branch={reccolor0}] (343.8765800000001,272.033) -| (317.4315900000001,314.02292) (317.4315900000001,327.63291) |- (347.42651000000006,348.9054025);
\path[branch={reccolor0}] (353.8765800000001,292.957955) -- (343.8765800000001,292.957955);
\draw[branch={reccolor0}] (404.1466000000001,299.892935) -| (371.7365800000001,286.27297500000003) (371.7365800000001,299.642935) |- (393.59658000000013,286.02297500000003);
\path[branch={reccolor0}] (384.4266000000001,272.033) -- (343.8765800000001,272.033);
\draw[branch={reccolor0}] (395.5365800000001,355.9278949999999) -| (376.17660000000006,344.6554025) (376.17660000000006,353.1554025) |- (384.42660000000006,341.88291);
\path[branch={reccolor0}] (357.42651,348.9054025) -- (347.42651000000006,348.9054025);
\draw[branch={reccolor0}] (371.92660000000006,348.9054025) |- (367.9266,348.9054025);
% gene transfers
\draw[transfer branch={reccolor0}] (148.24830500000002,189.518075) to[out=-90, in=90] (343.8765800000001,292.957955);
\draw[transfer branch={reccolor0}] (362.676555,344.6554025) to[out=90, in=-90] (371.92660000000006,202.07307);
% events
\node[speciation={reccolor0}] at (96.47,255.228005) {};
\node[loss={reccolor0}] at (107.47,263.478005) {};
\node[duplication={reccolor0}] at (49.11,249.728005) {a, b, c, d, e, f, g};
\node[speciation={reccolor0}] at (181.52661000000003,182.49978000000002) {};
\node[horizontal gene transfer={reccolor0}] at (148.24830500000002,182.49978000000002) {a, b, c, d};
\node[speciation={reccolor0}] at (212.94160500000004,166.50979) {c, d, e, f};
\node[loss={reccolor0}] at (241.85660000000004,193.518075) {};
\node[duplication={reccolor0}] at (169.02661000000003,159.76479500000002) {};
\node[speciation={reccolor0}] at (284.0515900000001,77.764925) {d, e, f, g};
\node[speciation={reccolor0}] at (315.74658000000005,61.70993) {};
\node[loss={reccolor0}] at (326.7465800000001,88.56992) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (383.4266,36.524950000000004) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (385.9266,22.534974999999996) {};
\node[extant gene={reccolor0}{c, d, e, f}] at (386.48659,8.489989999999999) {};
\node[extant gene={reccolor0}{d, e, f}] at (397.0365800000001,138.77981) {};
\node[extant gene={reccolor0}{c, e, f}] at (398.1565800000001,124.79983000000001) {};
\node[extant gene={reccolor0}{c, d, e}] at (395.6565800000001,110.87486) {};
\node[extant gene={reccolor0}{c, d, e}] at (395.6565800000001,97.00489999999999) {};
\node[duplication={reccolor0}] at (372.57658000000004,103.93987999999999) {c, d, e};
\node[duplication={reccolor0}] at (346.74658000000005,114.369855) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (383.42660000000006,230.043025) {};
\node[extant gene={reccolor0}{c, e, f}] at (398.1565800000001,216.118055) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (385.92660000000006,202.07307) {};
\node[speciation={reccolor0}] at (317.4315900000001,320.827915) {d, e, f, g};
\node[extant gene={reccolor0}{a, b}] at (405.6466000000001,299.892935) {};
\node[extant gene={reccolor0}{a, b, c}] at (395.09658000000013,286.02297500000003) {};
\node[duplication={reccolor0}] at (371.7365800000001,292.957955) {a, b, c};
\node[extant gene={reccolor0}{d, e, f, g}] at (385.9266000000001,272.033) {};
\node[extant gene={reccolor0}{d, e, f}] at (397.0365800000001,355.9278949999999) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (385.92660000000006,341.88291) {};
\node[duplication={reccolor0}] at (376.17660000000006,348.9054025) {};
\node[horizontal gene transfer={reccolor0}] at (362.676555,348.9054025) {\phantom{-}};
\end{tikzpicture}
