\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species border/.style={
        line width={1pt},
        shorten <={-1pt / 2 + 0.05pt},
        shorten >={-1pt / 2 + 0.05pt},
    },
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
        rounded corners,
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=west,
        align=left,
        xshift=10,
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\color{#1}},
                align=justify,
                inner xsep=4pt, inner ysep=0pt,
                outer xsep=0pt, outer ysep=0pt]
            right:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (79.88997999999998,147.2698) -- (54.88998,147.2698) -- (54.88998,238.478005) [sharp corners] -- (0,238.478005) -- (0,271.977975) [rounded corners] -- (54.88998,271.977975) -- (54.88998,340.13288) [sharp corners] -- (247.65658,340.13288) [rounded corners] -- (257.65657999999996,318.52289) -- (79.88998000000001,318.52289) -- (79.88998000000001,193.518075) [sharp corners] -- (89.88997999999998,193.518075) -- cycle;
\path[species background] (214.27658,44.95993) -- (139.94659,44.95993) -- (139.94659,147.2698) [sharp corners] -- (79.88997999999998,147.2698) -- (79.88997999999998,193.518075) [rounded corners] -- (139.94659,193.518075) -- (139.94659,238.478005) [sharp corners] -- (338.59658,238.478005) [rounded corners] -- (348.59658,193.518075) -- (214.27658,193.518075) -- (214.27658,88.56992) [sharp corners] -- (224.27658,88.56992) -- cycle;
\path[species background] (338.59658,0) -- (224.27658,0) -- (224.27658,44.95993) [sharp corners] -- (214.27658,44.95993) -- (214.27658,88.56992) [rounded corners] -- (224.27658,88.56992) -- (224.27658,147.2698) [sharp corners] -- (299.16656,147.2698) [rounded corners] -- (309.16656,88.56992) -- (299.16656,88.56992) -- (299.16656,44.95993) [sharp corners] -- (348.59658,44.95993) -- cycle;
\path[species background] (338.59658,0) -- (399.48656,0) -- (399.48656,44.95993) -- (338.59658,44.95993);
\path[species background] (299.16656,88.56992) -- (399.48656,88.56992) -- (399.48656,147.2698) -- (299.16656,147.2698);
\path[species background] (338.59658,193.518075) -- (399.48656,193.518075) -- (399.48656,238.478005) -- (338.59658,238.478005);
\path[species background] (310.54656,271.977975) -- (257.65657999999996,271.977975) -- (257.65657999999996,318.52289) [sharp corners] -- (247.65658,318.52289) -- (247.65658,340.13288) [rounded corners] -- (257.65657999999996,340.13288) -- (257.65657999999996,372.91785500000003) [sharp corners] -- (314.09649,372.91785500000003) [rounded corners] -- (324.09649,341.82788500000004) -- (310.54655999999994,341.82788500000004) -- (310.54655999999994,316.82788500000004) [sharp corners] -- (320.54656,316.82788500000004) -- cycle;
\path[species background] (310.54656,271.977975) -- (399.48656,271.977975) -- (399.48656,316.82788500000004) -- (310.54656,316.82788500000004);
\path[species background] (314.09649,341.82788500000004) -- (399.48656000000005,341.82788500000004) -- (399.48656000000005,372.91785500000003) -- (314.09649,372.91785500000003);
% species
\path[species border] (79.88997999999998,147.2698) -- (54.88998,147.2698) -- (54.88998,238.478005) -- (0,238.478005);
\path[species border] (247.65658,340.13288) -- (54.88998,340.13288) -- (54.88998,271.977975) -- (0,271.977975);
\path[species border] (79.88997999999998,193.518075) -- (79.88998000000001,193.518075) -- (79.88998000000001,318.52289) -- (247.65658,318.52289);
\path[species border] (214.27658,44.95993) -- (139.94659,44.95993) -- (139.94659,147.2698) -- (79.88997999999998,147.2698);
\path[species border] (338.59658,238.478005) -- (139.94659,238.478005) -- (139.94659,193.518075) -- (79.88997999999998,193.518075);
\path[species border] (214.27658,88.56992) -- (214.27658,88.56992) -- (214.27658,193.518075) -- (338.59658,193.518075);
\path[species border] (338.59658,0) -- (224.27658,0) -- (224.27658,44.95993) -- (214.27658,44.95993);
\path[species border] (299.16656,147.2698) -- (224.27658,147.2698) -- (224.27658,88.56992) -- (214.27658,88.56992);
\path[species border] (338.59658,44.95993) -- (299.16656,44.95993) -- (299.16656,88.56992) -- (299.16656,88.56992);
\path[species border] (338.59658,0) -- (399.48656,0) -- node[species label] {X} (399.48656,44.95993) -- (338.59658,44.95993);
\path[species border] (299.16656,88.56992) -- (399.48656,88.56992) -- node[species label] {Y} (399.48656,147.2698) -- (299.16656,147.2698);
\path[species border] (338.59658,193.518075) -- (399.48656,193.518075) -- node[species label] {Z} (399.48656,238.478005) -- (338.59658,238.478005);
\path[species border] (310.54656,271.977975) -- (257.65657999999996,271.977975) -- (257.65657999999996,318.52289) -- (247.65658,318.52289);
\path[species border] (314.09649,372.91785500000003) -- (257.65657999999996,372.91785500000003) -- (257.65657999999996,340.13288) -- (247.65658,340.13288);
\path[species border] (310.54656,316.82788500000004) -- (310.54655999999994,316.82788500000004) -- (310.54655999999994,341.82788500000004) -- (314.09649,341.82788500000004);
\path[species border] (310.54656,271.977975) -- (399.48656,271.977975) -- node[species label] {W} (399.48656,316.82788500000004) -- (310.54656,316.82788500000004);
\path[species border] (314.09649,341.82788500000004) -- (399.48656000000005,341.82788500000004) -- node[species label] {T} (399.48656000000005,372.91785500000003) -- (314.09649,372.91785500000003);
% gene branches
\draw[branch={reccolor0}] (79.88997999999998,159.76479500000002) -| (63.13998,256.47799000000003) (63.13998,264.97799000000003) |- (247.65658,329.327885);
\draw[branch={reccolor0}] (74.13998000000001,249.72799) -- (74.13998000000001,271.977975);
\draw[branch={reccolor0}] (74.13998000000001,249.72799) |- (79.88997999999998,182.49978000000002);
\path[branch={reccolor0}] (10.0,255.22799000000003) -- (0,255.22799);
\draw[branch={reccolor0}] (74.13998000000001,249.72799) -| (32.444990000000004,242.47800500000002) (32.444990000000004,267.977975) |- (58.88998,260.72799000000003);
\draw[branch={reccolor0}] (214.27658,50.70993) -| (148.19659,178.24978000000002) (148.19659,186.74978000000002) |- (338.59658,230.043025);
\path[branch={reccolor0}] (89.88997999999998,182.49978000000002) -- (79.88997999999998,182.49978000000002);
\draw[branch={reccolor0}] (143.94659,182.49978000000002) |- (139.94659,182.49978000000002);
\draw[branch={reccolor0}] (214.27658,61.70993) -| (179.611585,159.7698) (179.611585,173.24978000000002) |- (338.59658,216.118055);
\draw[branch={reccolor0}] (208.52658,153.0198) -- (208.52658,193.518075);
\draw[branch={reccolor0}] (208.52658,153.0198) |- (214.27658,77.76492499999999);
\path[branch={reccolor0}] (131.44659,159.76479500000002) -- (79.88997999999998,159.76479500000002);
\draw[branch={reccolor0}] (208.52658,153.0198) -| (135.69659,155.51479500000002) (135.69659,164.01479500000002) |- (157.44659,166.50979);
\path[branch={reccolor0}] (228.27658,77.764925) -- (214.27658,77.76492499999999);
\draw[branch={reccolor0}] (338.59658,22.534974999999996) -| (250.72156999999999,70.95993) (250.72156999999999,84.56992) |- (299.16656,138.77981);
\path[branch={reccolor0}] (278.16656,61.70993) -- (214.27658,61.70993);
\draw[branch={reccolor0}] (338.59658,8.489989999999999) -| (282.41656,57.45993) (282.41656,65.95993) |- (299.16656,114.369855);
\path[branch={reccolor0}] (293.41656,50.70993) -- (214.27658,50.70993);
\draw[branch={reccolor0}] (293.41656,50.70993) -- (293.41656,88.56992);
\draw[branch={reccolor0}] (293.41656,50.70993) |- (338.59658,36.524950000000004);
\path[branch={reccolor0}] (348.59658,36.524950000000004) -- (338.59658,36.524950000000004);
\path[branch={reccolor0}] (351.09658,22.534974999999996) -- (338.59658,22.534974999999996);
\path[branch={reccolor0}] (351.65657,8.489989999999999) -- (338.59658,8.489989999999999);
\path[branch={reccolor0}] (362.20655999999997,138.77981) -- (299.16656,138.77981);
\draw[branch={reccolor0}] (360.82656,110.87486) -| (339.24656,97.25489999999999) (339.24656,110.62486) |- (360.82656,97.00489999999999);
\path[branch={reccolor0}] (309.16656,114.369855) -- (299.16656,114.369855);
\draw[branch={reccolor0}] (363.32656,124.79983000000001) -| (313.41656,110.119855) (313.41656,118.619855) |- (321.66656,103.93987999999999);
\path[branch={reccolor0}] (348.59658,230.043025) -- (338.59658,230.043025);
\path[branch={reccolor0}] (363.32656,216.118055) -- (338.59658,216.118055);
\path[branch={reccolor0}] (351.09658,202.07307) -- (338.59658,202.07307);
\path[branch={reccolor0}] (261.65657999999996,329.32788500000004) -- (247.65658,329.327885);
\draw[branch={reccolor0}] (310.54656,280.53297000000003) -| (284.10157,322.52289) (284.10157,336.13288) |- (314.09649,357.40537250000006);
\path[branch={reccolor0}] (320.54656,301.45792500000005) -- (310.54656,301.45792500000005);
\draw[branch={reccolor0}] (370.81658,308.39290500000004) -| (338.40656,294.77294500000005) (338.40656,308.14290500000004) |- (360.26656,294.52294500000005);
\path[branch={reccolor0}] (351.09658,280.53297000000003) -- (310.54656,280.53297000000003);
\draw[branch={reccolor0}] (362.2065600000001,364.427865) -| (342.8465800000001,353.15537250000006) (342.8465800000001,361.65537250000006) |- (351.0965800000001,350.38288000000006);
\path[branch={reccolor0}] (324.09649,357.40537250000006) -- (314.09649,357.40537250000006);
\draw[branch={reccolor0}] (338.5965800000001,357.40537250000006) |- (334.59658,357.40537250000006);
% gene transfers
\draw[transfer branch={reccolor0}] (114.91828499999998,189.518075) to[out=-90, in=90] (310.54656,301.45792500000005);
\draw[transfer branch={reccolor0}] (329.346535,353.15537250000006) to[out=90, in=-90] (338.59658,202.07307);
% events
\node[speciation={reccolor0}] at (63.13998,260.72799000000003) {};
\node[loss={reccolor0}] at (74.13998000000001,271.977975) {};
\node[duplication={reccolor0}] at (32.444990000000004,255.22799000000003) {a, b, c,\\d, e, f, g};
\node[speciation={reccolor0}] at (148.19659,182.49978000000002) {};
\node[horizontal gene transfer={reccolor0}] at (114.91828499999998,182.49978000000002) {a, b, c, d};
\node[speciation={reccolor0}] at (179.611585,166.50979) {c, d, e, f};
\node[loss={reccolor0}] at (208.52658,193.518075) {};
\node[duplication={reccolor0}] at (135.69659,159.76479500000002) {};
\node[speciation={reccolor0}] at (250.72156999999999,77.764925) {d, e, f, g};
\node[speciation={reccolor0}] at (282.41656,61.70993) {};
\node[loss={reccolor0}] at (293.41656,88.56992) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (350.09658,36.524950000000004) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (352.59658,22.534974999999996) {};
\node[extant gene={reccolor0}{c, d, e, f}] at (353.15657,8.489989999999999) {};
\node[extant gene={reccolor0}{d, e, f}] at (363.70655999999997,138.77981) {};
\node[extant gene={reccolor0}{c, e, f}] at (364.82656,124.79983000000001) {};
\node[extant gene={reccolor0}{c, d, e}] at (362.32656,110.87486) {};
\node[extant gene={reccolor0}{c, d, e}] at (362.32656,97.00489999999999) {};
\node[duplication={reccolor0}] at (339.24656,103.93987999999999) {c, d, e};
\node[duplication={reccolor0}] at (313.41656,114.369855) {};
\node[extant gene={reccolor0}{a, b, c, d}] at (350.09658,230.043025) {};
\node[extant gene={reccolor0}{c, e, f}] at (364.82656,216.118055) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (352.59658,202.07307) {};
\node[speciation={reccolor0}] at (284.10157,329.32788500000004) {d, e, f, g};
\node[extant gene={reccolor0}{a, b}] at (372.31658,308.39290500000004) {};
\node[extant gene={reccolor0}{a, b, c}] at (361.76656,294.52294500000005) {};
\node[duplication={reccolor0}] at (338.40656,301.45792500000005) {a, b, c};
\node[extant gene={reccolor0}{d, e, f, g}] at (352.59658,280.53297000000003) {};
\node[extant gene={reccolor0}{d, e, f}] at (363.7065600000001,364.427865) {};
\node[extant gene={reccolor0}{d, e, f, g}] at (352.5965800000001,350.38288000000006) {};
\node[duplication={reccolor0}] at (342.8465800000001,357.40537250000006) {};
\node[horizontal gene transfer={reccolor0}] at (329.346535,357.40537250000006) {\phantom{-}};
\end{tikzpicture}
