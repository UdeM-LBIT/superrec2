\colorlet{species background color}{black!15}
\tikzset{
    x={1pt},
    y={-1pt},
    species background/.style={
        fill=species background color,
        draw=species background color,
        line width={1pt},
    },
    species label/.style={
        font=\bfseries,
        midway,
        anchor=west,
        align=left,
        xshift=10,
    },
    branch/.style={
        draw={#1},
        line width={0.5pt},
    },
    transfer branch/.style={
        branch={#1},
        -Stealth,
    },
    loss/.style={
        draw={#1}, cross out, thick,
        line width={0.5pt},
        inner sep=0pt,
        outer sep=0pt,
        minimum width={3},
        minimum height={3},
    },
    extant gene/.style 2 args={
        circle, fill={#1},
        outer sep=0pt, inner sep=0pt,
        minimum size={3},
        label={
            [font={\color{#1}},
                align=justify,
                inner xsep=4pt, inner ysep=0pt,
                outer xsep=0pt, outer ysep=0pt]
            right:#2
        },
    },
    extant gene/.default={black}{},
    branch node/.style={
        draw={#1}, fill={species background color!50!white},
        align=center,
        font={\color{#1}},
        outer sep=0pt, inner xsep=0pt, inner ysep=2pt,
        line width={0.5pt},
    },
    branch node/.default={black},
    speciation/.style={
        branch node={#1}, rectangle, rounded corners,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    duplication/.style={
        branch node={#1}, rectangle,
        inner xsep=4pt,
        minimum width={8},
        minimum height={8},
    },
    horizontal gene transfer/.style={
        branch node={#1}, chamfered rectangle,
        chamfered rectangle sep={8 / 2.4},
        inner xsep=2pt,
        inner ysep=-1pt,
        minimum width={8},
        minimum height={8},
    },
}
\definecolor{reccolor0}{HTML}{000000}
\begin{tikzpicture}
% background
\path[species background] (47.5,109.25985) [rounded corners={4pt}] -- (18.5,109.25985) -- (18.5,163.57974000000002) [sharp corners] -- (0,163.57974000000002) -- (0,188.57974000000002) [rounded corners={4pt}] -- (18.5,188.57974000000002) -- (18.5,234.14963) [sharp corners] -- (131.89001000000002,234.14963) -- (131.89001000000002,217.64963) [rounded corners={4pt}] -- (43.5,217.64963) -- (43.5,147.75985) [sharp corners] -- (47.5,147.75985) -- cycle;
\path[species background] (110.50009,35.56989) [rounded corners={4pt}] -- (68.00009,35.56989) -- (68.00009,109.25985) [sharp corners] -- (47.5,109.25985) -- (47.5,147.75985) [rounded corners={4pt}] -- (68.00009,147.75985) -- (68.00009,170.07974000000002) [sharp corners] -- (188.84009,170.07974000000002) -- (188.84009,134.50985) [rounded corners={4pt}] -- (106.50009,134.50985) -- (106.50009,74.06989) [sharp corners] -- (110.50009,74.06989) -- cycle;
\path[species background] (188.00009,0) [rounded corners={4pt}] -- (120.50009,0) -- (120.50009,35.56989) [sharp corners] -- (110.50009,35.56989) -- (110.50009,74.06989) [rounded corners={4pt}] -- (120.50009,74.06989) -- (120.50009,122.50985) [sharp corners] -- (163.00009,122.50985) -- (163.00009,74.06989) [rounded corners={4pt}] -- (159.00009,74.06989) -- (159.00009,35.56989) [sharp corners] -- (188.00009,35.56989) -- cycle;
\path[
                species background,
                rounded corners={4pt},
            ] (188.00009,0) -- (219.76309,0) -- node[species label] {X} (219.76309,35.56989) -- (188.00009,35.56989);
\path[
                species background,
                rounded corners={4pt},
            ] (163.00009,74.06989) -- (219.76309,74.06989) -- node[species label] {Y} (219.76309,122.50985) -- (163.00009,122.50985);
\path[
                species background,
                rounded corners={4pt},
            ] (188.84009,134.50985) -- (219.76309,134.50985) -- node[species label] {Z} (219.76309,170.07974000000002) -- (188.84009,170.07974000000002);
\path[species background] (173.56009,182.07974000000002) [rounded corners={4pt}] -- (141.89001000000002,182.07974000000002) -- (141.89001000000002,217.64963) [sharp corners] -- (131.89001000000002,217.64963) -- (131.89001000000002,234.14963) [rounded corners={4pt}] -- (141.89001000000002,234.14963) -- (141.89001000000002,262.44955) [sharp corners] -- (162.39001000000002,262.44955) -- (162.39001000000002,234.14963) [rounded corners={4pt}] -- (158.39001000000002,234.14963) -- (158.39001000000002,217.64963) [sharp corners] -- (173.56009,217.64963) -- cycle;
\path[
                species background,
                rounded corners={4pt},
            ] (173.56009,182.07974000000002) -- (219.76309,182.07974000000002) -- node[species label] {W} (219.76309,217.64963) -- (173.56009,217.64963);
\path[
                species background,
                rounded corners={4pt},
            ] (162.39001000000002,234.14963) -- (219.76309000000003,234.14963) -- node[species label] {T} (219.76309000000003,262.44955) -- (162.39001000000002,262.44955);
% species
% gene branches
\draw[branch={reccolor0}] (47.5,120.50985) -| (26.75,176.07974000000002) (26.75,184.57974000000002) |- (131.89001000000002,225.89963);
\draw[branch={reccolor0}] (37.75,169.32974000000002) -- (37.75,188.57974000000002);
\draw[branch={reccolor0}] (37.75,169.32974000000002) |- (47.5,139.50985);
\path[branch={reccolor0}] (10.0,174.82974000000002) -- (0,174.82974000000002);
\draw[branch={reccolor0}] (37.75,169.32974000000002) -| (14.25,170.57974000000002) (14.25,179.07974000000002) |- (22.5,180.32974000000002);
\draw[branch={reccolor0}] (110.50009,41.31989) -| (76.25009,135.25985) (76.25009,143.75985) |- (188.84009,163.174755);
\path[branch={reccolor0}] (57.5,139.50985) -- (47.5,139.50985);
\draw[branch={reccolor0}] (72.00009,139.50985) |- (68.00009,139.50985);
\draw[branch={reccolor0}] (110.50009,52.31989) -| (89.75009,121.75985) (89.75009,130.25985) |- (188.84009,152.364785);
\draw[branch={reccolor0}] (100.75009,115.00985) -- (100.75009,147.75985);
\draw[branch={reccolor0}] (100.75009,115.00985) |- (110.50009,65.81989);
\path[branch={reccolor0}] (59.50009,120.50985) -- (47.5,120.50985);
\draw[branch={reccolor0}] (100.75009,115.00985) -| (63.75009,116.25985) (63.75009,124.75985) |- (85.50009,126.00985);
\path[branch={reccolor0}] (124.50009,65.81989) -- (110.50009,65.81989);
\draw[branch={reccolor0}] (188.00009,17.854935) -| (128.75009,61.56989) (128.75009,70.06989) |- (163.00009,115.329855);
\path[branch={reccolor0}] (138.00009,52.31989) -- (110.50009,52.31989);
\draw[branch={reccolor0}] (188.00009,6.974975000000001) -| (142.25009,48.06989) (142.25009,56.56989) |- (163.00009,95.4498725);
\path[branch={reccolor0}] (153.25009,41.31989) -- (110.50009,41.31989);
\draw[branch={reccolor0}] (153.25009,41.31989) -- (153.25009,74.06989);
\draw[branch={reccolor0}] (153.25009,41.31989) |- (188.00009,28.664905);
\path[branch={reccolor0}] (198.00009,28.664905) -- (188.00009,28.664905);
\path[branch={reccolor0}] (198.00009,17.854935) -- (188.00009,17.854935);
\path[branch={reccolor0}] (198.00009,6.974975000000001) -- (188.00009,6.974975000000001);
\path[branch={reccolor0}] (198.00009,115.32985500000001) -- (163.00009,115.329855);
\draw[branch={reccolor0}] (198.00009,92.609875) -| (189.75009,82.67988) (189.75009,91.17988) |- (198.00009,81.249885);
\path[branch={reccolor0}] (173.00009,95.4498725) -- (163.00009,95.4498725);
\draw[branch={reccolor0}] (198.00009,103.96986500000001) -| (177.25009,91.1998725) (177.25009,99.6998725) |- (185.50009,86.92988);
\path[branch={reccolor0}] (198.84009,163.17475500000003) -- (188.84009,163.174755);
\path[branch={reccolor0}] (198.84009,152.36478500000004) -- (188.84009,152.364785);
\path[branch={reccolor0}] (198.84009,141.48482500000003) -- (188.84009,141.484825);
\path[branch={reccolor0}] (145.89001000000002,225.89963) -- (131.89001000000002,225.89963);
\draw[branch={reccolor0}] (173.56009,189.054715) -| (150.14001000000002,221.64963) (150.14001000000002,230.14963) |- (162.39001000000002,248.29959);
\path[branch={reccolor0}] (183.56009,205.33966) -- (173.56009,205.33966);
\draw[branch={reccolor0}] (196.06009,210.74464500000002) -| (187.81009,201.08966) (187.81009,209.58966) |- (196.06009,199.93467500000003);
\path[branch={reccolor0}] (196.06009,189.05471500000002) -- (173.56009,189.054715);
\draw[branch={reccolor0}] (199.39010000000002,254.62457) -| (191.14010000000002,244.04959) (191.14010000000002,252.54959) |- (199.39010000000002,241.97461);
\path[branch={reccolor0}] (172.39001000000002,248.29959) -- (162.39001000000002,248.29959);
\draw[branch={reccolor0}] (186.89010000000002,248.29959) |- (182.89010000000002,248.29959);
% gene transfers
\draw[transfer branch={reccolor0}] (62.750045,143.75985) to[out=-90, in=90] (173.56009,205.33966);
\draw[transfer branch={reccolor0}] (177.64005500000002,244.04959) to[out=90, in=-90] (188.84009,141.484825);
% events
\node[speciation={reccolor0}] at (26.75,180.32974000000002) {};
\node[loss={reccolor0}] at (37.75,188.57974000000002) {};
\node[duplication={reccolor0}] at (14.25,174.82974000000002) {};
\node[speciation={reccolor0}] at (76.25009,139.50985) {};
\node[horizontal gene transfer={reccolor0}] at (62.750045,139.50985) {\phantom{-}};
\node[speciation={reccolor0}] at (89.75009,126.00985) {};
\node[loss={reccolor0}] at (100.75009,147.75985) {};
\node[duplication={reccolor0}] at (63.75009,120.50985) {};
\node[speciation={reccolor0}] at (128.75009,65.81989) {};
\node[speciation={reccolor0}] at (142.25009,52.31989) {};
\node[loss={reccolor0}] at (153.25009,74.06989) {};
\node[extant gene={reccolor0}{x\textsubscript{1}}] at (199.50009,28.664905) {};
\node[extant gene={reccolor0}{x\textsubscript{2}}] at (199.50009,17.854935) {};
\node[extant gene={reccolor0}{x\textsubscript{3}}] at (199.50009,6.974975000000001) {};
\node[extant gene={reccolor0}{y\textsubscript{4}}] at (199.50009,115.32985500000001) {};
\node[extant gene={reccolor0}{y\textsubscript{1}}] at (199.50009,103.96986500000001) {};
\node[extant gene={reccolor0}{y\textsubscript{2}}] at (199.50009,92.609875) {};
\node[extant gene={reccolor0}{y\textsubscript{3}}] at (199.50009,81.249885) {};
\node[duplication={reccolor0}] at (189.75009,86.92988) {};
\node[duplication={reccolor0}] at (177.25009,95.4498725) {};
\node[extant gene={reccolor0}{z\textsubscript{1}}] at (200.34009,163.17475500000003) {};
\node[extant gene={reccolor0}{z\textsubscript{2}}] at (200.34009,152.36478500000004) {};
\node[extant gene={reccolor0}{z\textsubscript{3}}] at (200.34009,141.48482500000003) {};
\node[speciation={reccolor0}] at (150.14001000000002,225.89963) {};
\node[extant gene={reccolor0}{w\textsubscript{1}}] at (197.56009,210.74464500000002) {};
\node[extant gene={reccolor0}{w\textsubscript{2}}] at (197.56009,199.93467500000003) {};
\node[duplication={reccolor0}] at (187.81009,205.33966) {};
\node[extant gene={reccolor0}{w\textsubscript{3}}] at (197.56009,189.05471500000002) {};
\node[extant gene={reccolor0}{t\textsubscript{1}}] at (200.89010000000002,254.62457) {};
\node[extant gene={reccolor0}{t\textsubscript{2}}] at (200.89010000000002,241.97461) {};
\node[duplication={reccolor0}] at (191.14010000000002,248.29959) {};
\node[horizontal gene transfer={reccolor0}] at (177.64005500000002,248.29959) {\phantom{-}};
\end{tikzpicture}
